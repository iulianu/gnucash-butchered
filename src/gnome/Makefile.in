# Makefile -- makefile for gnucash/src/gnome                         
# Copyright (C) 1997 Robin Clark                                   
# Copyright (C) 1998 Linas Vepstas                                 
# Copyright (C) 1998 Rob Browning <rlb@cs.utexas.edu>
#                                                                  
# This program is free software; you can redistribute it and/or    
# modify it under the terms of the GNU General Public License as   
# published by the Free Software Foundation; either version 2 of   
# the License, or (at your option) any later version.              
#                                                                  
# This program is distributed in the hope that it will be useful,  
# but WITHOUT ANY WARRANTY; without even the implied warranty of   
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    
# GNU General Public License for more details.                     
#                                                                  
# You should have received a copy of the GNU General Public License
# along with this program; if not, contact:
#
# Free Software Foundation           Voice:  +1-617-542-5942
# 59 Temple Place - Suite 330        Fax:    +1-617-542-2652
# Boston, MA  02111-1307,  USA       gnu@gnu.org

include @top_srcdir@/Makefile.init

INCLPATH := -I.. \
            -I../.. \
            -I../guile \
            -I../engine \
            -I../engine/guid \
            -I../register \
            -I../reports \
            -I@top_srcdir@/src/g-wrap \
            -I${includedir} \
	    -I@top_srcdir@/src/register/gnome 

# All the other GNOME CFLAGS are handled in Makefile.common now
CFLAGS   = @CFLAGS@ ${INCLPATH} ${GUILE_COMPILE_ARGS} ${G_WRAP_COMPILE_ARGS}
LDFLAGS  = @LDFLAGS@

LIBS     = -L$(prefix)/lib @LIBS@ \
            $(shell ${GNOME_CONFIG_BIN} --libs gnomeui print @GTK_XMHTML@) \
            $(GUILE_LINK_ARGS) \
            $(G_WRAP_LINK_ARGS)

ifeq (${HAVE_PLOTUTILS},1)
  LIBS += @PLOTUTILS_LIBS@
endif

# Have to use wildcard here otherwise filters below won't get the expanded
# text to work on...
OTHER_OBJS += $(wildcard @top_srcdir@/src/obj/gnome/*.o)
OTHER_OBJS += $(wildcard @top_srcdir@/src/libengine.a)
OTHER_OBJS += $(wildcard @top_srcdir@/src/register/obj/gnome/*.o)
OTHER_OBJS += $(wildcard @top_srcdir@/src/reports/obj/*.o) 
OTHER_OBJS += $(wildcard @top_srcdir@/src/guile/obj/*.o)
OTHER_OBJS += $(wildcard @top_srcdir@/src/guile/obj/gnome/*.o)
OTHER_OBJS += $(wildcard @top_srcdir@/src/swig/obj/*.o)
OTHER_OBJS += $(wildcard @top_srcdir@/src/g-wrap/obj/*.o)
OTHER_OBJS += $(wildcard @top_srcdir@/src/g-wrap/obj/gnome/*.o)
OTHER_OBJS += $(wildcard @top_srcdir@/src/register/gnome/obj/gnome/*.o)

######################################################################
# See Makefile.common for information about these variables.
GNOME_SRCS := top-level.c window-main.c window-register.c window-adjust.c \
              window-help.c cursors.c account-tree.c dialog-budget.c \
              window-reconcile.c window-html.c \
              dialog-options.c dialog-filebox.c dialog-transfer.c \
              dialog-add.c dialog-edit.c dialog-utils.c \
              extensions.c query-user.c reconcile-list.c \
	      window-report.c gnc-dateedit.c gnc-currency-edit.c \
	      dialog-qif-import.c glade-gnc-dialogs.c gnc-datedelta.c \
	      dialog-account-picker.c print-session.c file-history.c \
	      dialog-print-check.c dialog-find-transactions.c
######################################################################

all: gnome

# This inclusion must come after the first target, and after the
# definitions of *_SRCS, etc., but before the usage of *_OBJS.
include @top_srcdir@/Makefile.common

gnome: @top_srcdir@/gnucash.gnome
@top_srcdir@/gnucash.gnome: ${GNOME_OBJS} ${OTHER_OBJS}
	$(CC) $(LDFLAGS) -o $@ $^ $(LIBS)

gnome.static: @top_srcdir@/gnucash.gnome.static
@top_srcdir@/gnucash.gnome.static: ${GNOME_OBJS} ${OTHER_OBJS}
	$(CC) -static $(LDFLAGS) -o $@ $^ $(LIBS)
